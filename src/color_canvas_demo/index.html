<head>
  <title> Wasm Trial </title>
  <script>
    WebAssembly
      .instantiateStreaming(fetch("main.wasm"), { env: {} })
      .then(wasm => {
        const {
          memory: { buffer },
          get_c_pixels,
          get_canvas_width,
          get_canvas_height,
          get_canvas_color_channel,
        } = wasm.instance.exports;

        const canvas_width = get_canvas_width();
        const canvas_height = get_canvas_height();
        const canvas_color_channel = get_canvas_color_channel();

        paint_canvas('canvas_1');
        paint_canvas('canvas_2');
        paint_canvas('canvas_3');

        function paint_canvas(id) {
          // Get our canvas element from our index.html
          const canvasElement = document.getElementById(id);
          canvasElement.style.position = 'sticky';
          canvasElement.width = canvas_width;
          canvasElement.height = canvas_height;

          // Set up Context and ImageData on the canvas
          const canvasContext = canvasElement.getContext("2d");
          const canvasImageData = canvasContext.createImageData(canvas_width, canvas_height);

          // Set the values to the canvas image data
          canvasImageData.data.set(new Uint32Array(buffer, get_c_pixels(), canvas_width * canvas_height * canvas_color_channel));

          // Clear the canvas
          canvasContext.clearRect(0, 0, canvas_width, canvas_height);

          // Place the new generated checkerboard onto the canvas
          canvasContext.putImageData(canvasImageData, 0, 0);
        }

      });
  </script>
  <style>
    body {
      padding: 16px 8px;
      font-size: 20px;
    }

    div#out {
      display: flex; 
      flex-direction: column; 
      gap: 24px;
    }
  </style>
</head>
<body>
  <div id="out">
    <div><canvas id="canvas_1"></canvas></div>
    <div><canvas id="canvas_2"></canvas></div>
    <div><canvas id="canvas_3"></canvas></div>
  </div>
</body>
